<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.104.3"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Unified Kernel Image (UKI) # A Unified Kernel Image (UKI) is the combination of a Linux kernel image, and initrd, a UEFI boot stub program (and further resources, see below) into one single UEFI PE file that can either be directly invoked by the UEFI firmware (which is useful in particular in some cloud/Confidential Computing environments) or through a boot loader (which is generally useful to implement support for multiple kernel versions, with interactive or automatic selection of image to boot into, potentially with automatic fallback management to increase robustness)."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Unified Kernel Image"><meta property="og:description" content="Unified Kernel Image (UKI) # A Unified Kernel Image (UKI) is the combination of a Linux kernel image, and initrd, a UEFI boot stub program (and further resources, see below) into one single UEFI PE file that can either be directly invoked by the UEFI firmware (which is useful in particular in some cloud/Confidential Computing environments) or through a boot loader (which is generally useful to implement support for multiple kernel versions, with interactive or automatic selection of image to boot into, potentially with automatic fallback management to increase robustness)."><meta property="og:type" content="article"><meta property="og:url" content="https://uapi-group.org/specifications/docs/unified_kernel_image/"><meta property="article:section" content="docs"><title>Unified Kernel Image | UAPI Group Specifications</title><link rel=manifest href=/specifications/manifest.json><link rel=icon href=/specifications/favicon.png type=image/x-icon><link rel=stylesheet href=/specifications/book.min.f716a89e40b01f033146ee402497165ac5bcf8935948094dceafbcb19f6f3c8d.css integrity="sha256-9xaonkCwHwMxRu5AJJcWWsW8+JNZSAlNzq+8sZ9vPI0="><script defer src=/specifications/en.search.min.3a0a3e4f8292e19fd1b3a61a81b3210da436a68e954c89c433c824944cac23ca.js integrity="sha256-Ogo+T4KS4Z/Rs6YagbMhDaQ2po6VTInEM8gklEysI8o="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/specifications><span>UAPI Group Specifications</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://uapi-group.org/>⬅️ Back to top</a></li><li>⸻</li></ul><ul><li><a href=https://uapi-group.org/specifications/docs/base_directory_specification/>Base Directory Specification</a></li><li><a href=https://uapi-group.org/specifications/docs/boot_loader_specification/>Boot Loader Specification</a></li><li><a href=https://uapi-group.org/specifications/docs/discoverable_disk_image/>Discoverable Disk Image</a></li><li><a href=https://uapi-group.org/specifications/docs/discoverable_partitions_specification/>Discoverable Partitions Specification</a></li><li><a href=https://uapi-group.org/specifications/docs/linux_tpm_pcr_registry/>Linux TPM PCR Registry</a></li><li><a href=https://uapi-group.org/specifications/docs/sysext/>Sysext - System Extension</a></li><li><a href=https://uapi-group.org/specifications/docs/unified_kernel_image/ class=active>Unified Kernel Image</a></li></ul><ul><li>⸻</li><li><a href=https://github.com/uapi-group/specifications target=_blank rel=noopener>Collaborate on Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/specifications/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Unified Kernel Image</strong>
<label for=toc-control><img src=/specifications/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#file-format>File Format</a></li><li><a href=#uki-components>UKI Components</a><ul><li><a href=#json-format-for-pcrsig>JSON Format for <code>.pcrsig</code></a></li></ul></li><li><a href=#updatability>Updatability</a></li><li><a href=#security>Security</a></li></ul></nav></aside></header><article class=markdown><h1 id=unified-kernel-image-uki>Unified Kernel Image (UKI)
<a class=anchor href=#unified-kernel-image-uki>#</a></h1><p>A Unified Kernel Image (UKI) is the combination of a Linux kernel image, and initrd, a UEFI boot stub
program (and further resources, see below) into one single UEFI PE file that can either be directly
invoked by the UEFI firmware (which is useful in particular in some cloud/Confidential Computing
environments) or through a boot loader (which is generally useful to implement support for multiple
kernel versions, with interactive or automatic selection of image to boot into, potentially with
automatic fallback management to increase robustness).</p><p>This specification defines the format and components (mandatory and optional) of UKIs.</p><h2 id=file-format>File Format
<a class=anchor href=#file-format>#</a></h2><p>The file format is PE/COFF (Portable Executable / Common Object File Format). This is a well-known
industry-standard file format, used for example in UEFI environments, and UKIs use it verbatim, so exact
details will not be redefined here.</p><p>UKIs can be generated via a
<a href=https://www.freedesktop.org/software/systemd/man/systemd-stub.html#Assembling%20Kernel%20Images>single, relatively simple <code>objcopy</code>
invocation</a>,
that glues the listed components together, generating one PE binary that then can be signed for SecureBoot.</p><h2 id=uki-components>UKI Components
<a class=anchor href=#uki-components>#</a></h2><p>Specifically, UKIs typically consist of the following resources:</p><ul><li>An UEFI boot stub that is a small piece of code still running in UEFI mode and that transitions into the Linux kernel included in the UKI (e.g., as implemented in
<a href=https://www.freedesktop.org/software/systemd/man/systemd-stub.html>sd-stub</a>)</li><li>The Linux kernel to boot in the <code>.linux</code> PE section</li><li>The initrd that the kernel shall unpack and invoke in the <code>.initrd</code> PE section</li><li>A kernel command line string, in the <code>.cmdline</code> PE section</li><li>Optionally, information describing the OS this kernel is intended for, in the <code>.osrel</code> PE section (derived from <code>/etc/os-release</code> of the booted OS). This is useful for presentation of the UKI in the boot loader menu, and ordering it against other entries, using the included version information.</li><li>Optionally, information describing kernel release information (i.e. uname -r output) in the <code>.uname</code> PE section. This is also useful for presentation of the UKI in the boot loader menu, and ordering it against other entries.</li><li>Optionally, a boot splash to bring to screen before transitioning into the Linux kernel in the <code>.splash</code> PE section</li><li>Optionally, a compiled Devicetree database file, for systems which need it, in the <code>.dtb</code> PE section</li><li>Optionally, the public key in PEM format that matches the signatures of the <code>.pcrsig</code> PE section (see below), in a <code>.pcrpkey</code> PE section.</li><li>Optionally, a JSON file encoding expected PCR 11 hash values seen from userspace once the UKI has booted up, along with signatures of these expected PCR 11 hash values, matching a specific public key in the <code>.pcrsig</code> PE section.</li></ul><h3 id=json-format-for-pcrsig>JSON Format for <code>.pcrsig</code>
<a class=anchor href=#json-format-for-pcrsig>#</a></h3><p>The format is a single JSON object, encoded as a zero-terminated <code>UTF-8</code> string. Each name in the object
shall be unique as per recommendations of
<a href=https://datatracker.ietf.org/doc/html/rfc8259#section-4>RFC8259</a>. Strings shall not contain any control
character, nor use <code>\uXXX</code> escaping.</p><p>When it comes to JSON numbers, this specification assumes that JSON parsers processing this information
are capable of reproducing the full signed 53bit integer range (i.e. -2⁵³+1…+2⁵³-1) as well as the full
64bit IEEE floating point number range losslessly (with the exception of NaN/-inf/+inf, since JSON cannot
encode that), as per recommendations of
<a href=https://datatracker.ietf.org/doc/html/rfc8259#page-8>RFC8259</a>.
Fields in these JSON objects are thus permitted to encode numeric values from these ranges as JSON numbers,
and should not use numeric values not covered by these types and ranges.</p><p>The content is a JSON object, named after the TPM SHA bank to use, containing an array of measurement
objects, each containing an array of PCRs, the SHA256 fingerprint of the public key (DER) used for the
signature (<code>pkfp</code>), the expected hash (<code>pol</code>) and the signature encoded in base64 (<code>sig</code>).</p><p>Example:</p><pre tabindex=0><code>{
    &#34;sha1&#34;: [
        {
            &#34;pcrs&#34;: [
                11
            ],
            &#34;pkfp&#34;: &#34;2870989436ec5c24461f36f5f070613043c30a156a895903e27fc985d1b2887f&#34;,
            &#34;pol&#34;: &#34;4a5cfbca5123490989ac060ec8b1755cfa6f0ea37ec39206e988442a9a9023bb&#34;,
            &#34;sig&#34;: &#34;X9a07Peo0EaEWr0dfUgZIq3Bsf20AGTjAgMilyH3TkLtPBGJLCEFRzK2jkPohG0VXQjao35765Wp/sV1wfctGC0fx9GOsBzK8YKjsFitOw21aLxlnES31D3PbDLPRqkx+fAhwV0/Akd99hNuiyzGdUewNpbbBNo7WXkd4K62RK61dKKI4g//qtLeAyXlee0TLKVxNcT46Ud1t8eUb1GAwRnO7DxBZx8uFyP/D9wpPNK7+M01to74d9ijcsjLXf2eGKcpiDvenUnhI6ua+OvT6CnmgxkFQutLGz/Ka23spSG/YJHfxGT7VpOYveDG19nqBb/fg30HZiY7lVTolS93UA==&#34;
        }
    ],
    &#34;sha256&#34;: [
        {
            &#34;pcrs&#34;: [
                11
            ],
            &#34;pkfp&#34;: &#34;2870989436ec5c24461f36f5f070613043c30a156a895903e27fc985d1b2887f&#34;,
            &#34;pol&#34;: &#34;707f5d03325822b2a53bfe5d723e0ca290f397c0e6184131b70d00e35224488a&#34;,
            &#34;sig&#34;: &#34;moQh6GF18LiVlA8CxRkTtbXr2p0NIIBosLazDALZ9lOJQw/w1PB7tcDZ1Kumvzqtx4FO5WVjOkVTnNFrYmXn9K2PpqIDEuTtwaM/lKgP12LtcC635C+VsJMQg3k9sEFfLwBCzrhYxt5GCpxzPrsfwJtsUpueB23sNw27WJS7C+tVnqWw7br6i9vJ59jP9+HXlex+OlZHliHLzZwpuZA8iPMQT0xvm901ak5yoBqNPv4Yya19dlt2sCuO+Iw1LeZW9U83zdG0hn1mxavRIxZ7s0f7a1n/ScrOksgPQB8xfDdFDf9fssGALanOgjCHyD7hRzV31++Qpgah4uc/LJiesg==&#34;
        }
    ]
}
</code></pre><p>The
<a href=https://www.freedesktop.org/software/systemd/man/systemd-measure.html><code>systemd-measure</code></a> tool can be
used to generate and sign <code>.pcrsig</code>.</p><h2 id=updatability>Updatability
<a class=anchor href=#updatability>#</a></h2><p>UKIs wrap all of the above data in a single file, hence all of the above components can be updated in one go
through single file atomic updates, which is useful given that the primary expected storage place for these
UKIs is the UEFI System Partition (ESP), which is a vFAT file system, with its limited data safety guarantees.</p><h2 id=security>Security
<a class=anchor href=#security>#</a></h2><p>Given UKIs are regular UEFI PE files, they can thus be signed as one for SecureBoot, protecting all of the
individual resources listed above at once, and their combination. Standard Linux tools such as
<a href=https://manpages.debian.org/unstable/sbsigntool/sbsign.1.en.html><code>sbsigntool</code></a> and
<a href=https://github.com/rhboot/pesign><code>pesign</code></a> can be used to sign UKI files. The signature format and process
again match the ones already used for PE files, so they will not be redefined here.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/uapi-group/specifications/edit/main/specs/unified_kernel_image.md target=_blank rel=noopener><img src=/specifications/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#file-format>File Format</a></li><li><a href=#uki-components>UKI Components</a><ul><li><a href=#json-format-for-pcrsig>JSON Format for <code>.pcrsig</code></a></li></ul></li><li><a href=#updatability>Updatability</a></li><li><a href=#security>Security</a></li></ul></nav></div></aside></main></body></html>